# 一、数据结构

使用struct定义：

- RANGE：data可能的范围

- DATA：数据

- NODE：节点

- EDGE：边

- PATH：路径

  ==注：对于成环的情况，会不存储导回环路的边，且给整个路径加上_cycle()标记==

- GRAPH：需求图

- DATA_DIC：数据字典，存储数据的名称，数据的类型（内部/外部），数据的值域与数据的可能取值

使用class定义：

- GRAPHS：全部需求图

# 二、主要函数

在GRAPHS中，实现了诸多成员函数，现逐个介绍：

## （1）initialization

- 功能：

​		从input.txt中读取信息并进行处理，对所有的结构体与类的内部成员变量进行赋值

## （2）output

- 功能：

  将当前各成员变量打印到控制台，方便检查



<u>分界线：以上为基本函数，以下为项目所需功能函数</u>

==注：对于无限循环的检测由于同时涉及到路径的存储，故内置于initialization函数中==

## （3）output_path_dic

- 功能：

  输出路径字典到path_dic.txt文件

## （4）dependency_extraction

- 功能：

  提取依赖关系，根据需求不同，将各个版本输出到dependency_extract_path.txt，dependency_extract_graph.txt以及部分的output.txt

## （5）graph_miss_detect

- 功能：

  需求图缺失检测，包括外部需求图缺失与内部先读后写问题的检测（特例）

- 算法：

  遍历每个节点的数据，判断这个数据在外部需求图中有没有制造方
  	yes：不报错
  	no：判断内部有没有制造方
  		no：报错需求缺失
  		yes：判断是否至少存在一条路径，其中制造方节点在本节点之前			
  				yes：不报错
  				no：报错先读后写

  遍历每个边的数据，判断这个数据在外部需求图中有没有制造方
  	yes：不报错
  	no：内部有没有制造方
  		no：报错需求缺失
  		yes：判断是否至少存在一条路径，其中制造方节点在本节点之前			
  				yes：不报错
  				no：报错先读后写

## （6）check_dependency_cycle

- 功能：

  循环依赖检测

## （7）checkEdgeConditionUnsatisfiable

- 功能：

  检测边条件是否可能永远无法满足

- 思路：

  将边送入转换函数（功能为：将一个字符串类型的条件转换为一个z3类型的表达式并返回）；

  将表达式送入求解器，并分析表达式，提取出其中的所有z3变量；

  然后对所有z3变量，得到其字符串形式；

  用字符串进行查表（数据字典），并得到对应的值域；

  将值域构成对应变量的z3表达式，并送入求解器

  <u>若返回结果为可满足，说明正常，否则报错。</u>

## （8）checkGraphEdgesForSMT

- 功能：

  检测一个节点的各个分支有无可能有至少两条能同时满足

- 思路：

  先得到一个节点的全部出边；

  然后将这些出边送入转换函数，得到对应的z3表达式并送入求解器；

  分析表达式，提取出其中的所有z3变量；

  然后对所有z3变量，得到其字符串形式；

  用字符串进行查表（数据字典），并得到对应的值域；

  将值域构成对应变量的z3表达式，并送入求解器

  将边中的条件两两一组送入求解器，确保每个两两组合都被遍历到；
  
  若至少有一组返回结果为可满足，报错“分支同时满足”，若遍历完成都未返回可满足的结果，说明无错


